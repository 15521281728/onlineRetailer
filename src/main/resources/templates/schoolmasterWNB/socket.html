<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<!--    <link rel="stylesheet" href="../frame/layui/css/layui.css">-->
<!--    <link rel="stylesheet" href="../frame/static/css/style.css">-->
<!--    <link rel="icon" href="../frame/static/image/code.png">-->
    <title>websocket</title>
    <script type="text/javascript" src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.min.js"></script>
    <script src="http://cdn.bootcss.com/stomp.js/2.3.3/stomp.min.js"></script>
    <script src="https://cdn.bootcss.com/sockjs-client/1.1.4/sockjs.min.js"></script>
</head>
<css>

</css>
<body>

<button onclick="fun()">开始连接</button>
<!--   socket url -->
<input  type="hidden" th:value="${path}" id="path"  style="display: none" />
<!--  用户名 -->
<input  type="hidden" th:value="${username}" id="username"  style="display: none" />


<!-- ===============================================================================================================  -->
<br>

<!--<input  type="hidden" value="所有人" id="onLineUser" text="所有人" style="display: none" />-->


<!-- ===============================================================================================================  -->
<!--    overflow-y :auto;overflow :auto;  宽高自适应滚动条-->
<span id = "miqx" style="width:80%;height:300px; background-color: papayawhip;float:left;overflow-y :auto;overflow :auto;">
    <li style="text-align: center">群聊信息</li>
</span>
<span id = "miax" style="width:20%;background-color: #F2F2F2;float:left;overflow-y :auto;overflow :auto;">
    <li style="text-align: center">在线列表</li>
</span>

<textarea id="text" placeholder="请输入内容-发送消息[Ctrl+回车键]" rows="3%" cols="60%"></textarea>


<input onclick="send()" type="button" value="发送">
<td>消息发送至:</td>
<select id="onLineUser" size="1" style="width: 10%;height:30px">
    <option  value="所有人">所有人</option>
</select>


<div  id = "mizx"  style="width:80%;height:300px;background-color: #FFEEE8;float:left;overflow-y :auto;overflow :auto;">
    <li style="text-align: center">私聊信息</li>
    <!--    <li style="text-align: right">靠右</li>
        <li style="text-align: left" >靠左</li>-->
</div>
<br>
<br>

<!-- ===============================================================================  -->

</body>
<script type="text/javascript">
    $(window).load(onLoad());
    // window.onload = onLoad();
    console.log("aaa");
    var userInfo = "";
    var socket;
    function onLoad() {
        getUserInfo();
        // sessionStorage.setItem("user",userInfo);
        chatConnect();
    }
    function chatConnect() {
        console.log(userInfo)
        var user = userInfo;
        var username = user.customerAccount;
        var wsUri = "ws://localhost:8080/imserver/" + username;
        // console.log(username)
        //开启websocket服务
        socket = new WebSocket(wsUri);
        //websocket建立连接
        socket.onopen = function(evt) {
            console.log("成功建立连接")
        };
        //websocket监听接收消息
        socket.onmessage = function(msg) {
            console.log(msg)
        }
        //发送消息
        // socket.send("hello");
    }
    function getUserInfo() {
        var requestUri = "/getCustomerInfo";
        $.ajax(
            {
                url:requestUri,
                async:false,
                cache:false,
                success:function (data) {
                    // console.log(data);
                    userInfo = JSON.parse(data);
                }
            }
        )
    }
    function send() {
        var user = userInfo
        var text22 = "document.getElementById().textContent";
        var message = {"from":user.username,"content":text22,"to":"undefined"}
        console.log(message)
        socket.send(JSON.stringify(message));
    }
</script>
</html>

